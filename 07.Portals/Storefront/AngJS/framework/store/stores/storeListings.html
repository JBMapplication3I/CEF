<div ng-if="storeListingsCtrl.$location.search().state && storeListingsCtrl.$location.search().county" cef-store-listings-county></div>
<div id="wrapper" ng-if="storeListingsCtrl.$location.search().state && !storeListingsCtrl.$location.search().county">
    <main id="main">
        <div class="container py-30 py-lg-60">
            <div class="row">
                <div class="col">
                    <div class="text-center pb-20 pb-lg-45">
                        <a ui-sref-plus uisrp-root="/Your-Team-Store" class="btn btn-link btn-back mb-5">
                            <img src="images/arrow-red.svg" width="17" height="14" alt="image description"> Back To Search
                        </a>
                        <h1 ng-bind-html="storeListingsCtrl.stateName"></h1>
                    </div>
                    <ul class="tabset tabset-counties list-unstyled mb-md-30">
                        <li>
                            <a class="link btn btn-link border-0 p-0"
                                ng-class="storeListingsCtrl.activeTab === 'All' ? 'active' : ''"
                                ng-click="storeListingsCtrl.filtersSelected('All')">All Counties</a>
                        </li>
                        <li>
                            <a class="link btn btn-link border-0 p-0"
                                ng-class="storeListingsCtrl.activeTab === 'Active' ? 'active' :  ''"
                                ng-click="storeListingsCtrl.filtersSelected('Active')">Active Counties</a>
                        </li>
                        <li>
                            <a class="link btn btn-link border-0 p-0"
                                ng-class="storeListingsCtrl.activeTab === 'Available' ? 'active' : ''"
                                ng-click="storeListingsCtrl.filtersSelected('Available')">Available to Franchise</a>
                        </li>
                    </ul>
                    <div class="tab-content tab-content-counties">
                        <div id="tab1">
                            <div class="control-panel row justify-content-between align-items-center mx-0 mb-15">
                                <div class="col-md-6 col-lg-5">
                                    <p>
                                        <small><strong>*Please note</strong> - some unmarked counties still have Franchise opportunities. 
                                        Please visit those counties for more information.
                                        </small>
                                    </p>
                                </div>
                                <div class="col-md-6 col-lg-3 d-md-flex justify-content-end">
                                    <div class="form-inline">
                                        <label for="select-counters">Show</label>
                                        <select id="select-counters" 
                                            class="custom-select mb-10 mb-sm-0 mx-sm-7"
                                            ng-model="storeListingsCtrl.numRows"
                                            ng-change="storeListingsCtrl.filtersSelected(storeListingsCtrl.activeTab, 1)"
                                            ng-init="storeListingsCtrl.size 
                                                ? storeListingsCtrl.numRows = storeListingsCtrl.size
                                                : storeListingsCtrl.numRows = storeListingsCtrl.numRowsPerPage[0]"
                                            ng-options="num for num in storeListingsCtrl.numRowsPerPage">
                                            <option value="" ng-show="false"></option>
                                        </select>
                                        <span>per page</span>
                                        <input type="submit" value="submit" class="sr-only">
                                    </div>
                                </div>
                            </div>
                            <div class="counties-table table-responsive mb-xl-90">
                                <form>
                                    <table class="table table-striped table-borderless mb-0" title="team stores table">
                                        <thead>
                                            <tr>
                                                <th scope="col" abbr="County">
                                                    <div class="form-inline form-search-county">
                                                        <label for="search-county" class="mb-5 mb-md-0">County name</label>
                                                        <div class="input-group ml-md-15">
                                                            <input id="search-county"
                                                                class="form-control"
                                                                type="search"
                                                                ng-model="storeListingsCtrl.searchTerm"
                                                                placeholder="County Lookup…">
                                                            <button class="btn-search" type="submit">
                                                                <img src="images/search.svg" width="24" height="24" alt="Opener search">
                                                                <span class="sr-only">Submit search</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </th>
                                                <th scope="col">Operated by</th>
                                                <th scope="col" abbr="Available">Available to Franchise</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- TODO: replace filterCounties with all counties and use ng-if to show filtered counties -->
                                            <tr ng-repeat="county in storeListingsCtrl.counties
                                                    | filter: {'Name': storeListingsCtrl.searchTerm}"
                                                ng-if="storeListingsCtrl.showCounty($index, county.ID)">
                                                <!-- <tr ng-repeat="county in (storeListingsCtrl.activeTab === 'Active'
                                                ? storeListingsCtrl.filterCounties('Active')
                                                : storeListingsCtrl.activeTab === 'Available'
                                                    ? storeListingsCtrl.filterCounties('Available')
                                                    : storeListingsCtrl.filterCounties('All'))
                                                | filter: {'Name': storeListingsCtrl.searchTerm}
                                                | limitTo: storeListingsCtrl.numRows"> -->
                                                <td>
                                                    <span ng-bind="county.Name" ng-class="storeListingsCtrl.countyIDAndFranchise[county.ID] ? 'font-weight-bold' : ''">Catawba</span>
                                                    <a href="#"
                                                        ng-if="storeListingsCtrl.countyIDAndFranchise[county.ID]"
                                                        ui-sref-plus 
                                                        uisrp-root="/Store-Listings#!?state={{storeListingsCtrl.stateName}}&county={{county.Name}}">&nbsp;|&nbsp;Visit »</a>
                                                </td>
                                                <td>{{storeListingsCtrl.countyIDAndFranchise[county.ID] || '-'}}</td>
                                                <td>
                                                    <a ng-if="!storeListingsCtrl.countyIDAndFranchise[county.ID]""
                                                        ui-sref-plus
                                                        uisrp-root="/Quick-Quote">
                                                        <img src="images/flag.svg" width="16" height="16" alt="image flag" class="mr-10" />Apply
                                                    </a>
                                                    <span ng-if="storeListingsCtrl.countyIDAndFranchise[county.ID]" class="text-muted">Unavailable</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="3">
                                                    <nav aria-label="Table navigation" class="nav-table py-15">
                                                        <ul class="pagination mb-0 justify-content-center">
                                                            <li class="page-item prev"
                                                                ng-class="storeListingsCtrl.page <= 1 ? 'disabled' : 'pointer'">
                                                                <a class="page-link" aria-label="Previous"
                                                                    ng-click="storeListingsCtrl.filtersSelected(storeListingsCtrl.activeTab, storeListingsCtrl.page - 1)">
                                                                    <i class="far fa-angle-left fa-fw"></i><span class="sr-only">Previous</span>
                                                                </a>
                                                            </li>
                                                            <li class="page-item pointer"
                                                                ng-repeat="page in [].constructor(storeListingsCtrl.numPages) track by $index"
                                                                ng-class="storeListingsCtrl.page === $index+1 ? 'active' : ''"
                                                                aria-current="page">
                                                                <a class="page-link"
                                                                    ng-bind="$index+1"
                                                                    ng-click="storeListingsCtrl.filtersSelected(storeListingsCtrl.activeTab, $index+1)"></a>
                                                            </li>
                                                            <li class="page-item next"
                                                                ng-class="storeListingsCtrl.page >= storeListingsCtrl.numPages ? 'disabled' : 'pointer'">
                                                                <a class="page-link" aria-label="Next"
                                                                    ng-click="storeListingsCtrl.filtersSelected(storeListingsCtrl.activeTab, storeListingsCtrl.page + 1)">
                                                                    <i class="far fa-angle-right fa-fw"></i><span class="sr-only">Next</span>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </nav>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
</div>