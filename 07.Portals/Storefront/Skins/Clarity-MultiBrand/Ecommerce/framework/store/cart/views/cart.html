<div class="row">
  <div cef-cart-validator class="col-12 mt-3" type="cartCtrl.type"></div>
  <div ng-if="cartCtrl.cartItems.length > 20"
    class="col-12">
    <div cef-paging-header paging="cartCtrl.cartItemsPaging"></div>
  </div>
  <div class="col-12">
    <div class="table-responsive">
      <table class="data-table cart-table table table-sm table-striped table-hover table-bordered"
        id="tblCart_{{cartCtrl.type}}">
        <colgroup>
          <col class="w-0                  lg-w-auto" />
          <col class="w-22 sm-w-22 md-w-20 lg-w-16   xl-w-16 tk-w-20 fk-w-16" />
          <col class="w-38 sm-w-38 md-w-26 lg-w-32   xl-w-40 tk-w-40 fk-w-48" />
          <col class="w-0          md-w-13 lg-w-10   xl-w-8  tk-w-8  fk-w-8 " />
          <col class="w-30 sm-w-30 md-w-30 lg-w-20   xl-w-16 tk-w-12 fk-w-8 " />
          <col class="w-10 sm-w-10 md-w-12 lg-w-10   xl-w-8  tk-w-8  fk-w-8 " />
          <col class="w-auto" />
        </colgroup>
        <thead>
          <tr class="first last">
            <th class="w-0"></th>
            <th data-translate="ui.storefront.cart.SKU"></th>
            <th data-translate="ui.storefront.common.Name"></th>
            <th class="w-0 text-center"
              data-translate="ui.storefront.common.Price"></th>
            <th class="text-center"
              data-translate="ui.storefront.common.Quantity"></th>
            <th class="text-center"
              data-translate="ui.storefront.common.Subtotal"></th>
            <th></th>
          </tr>
        </thead>
        <tbody ng-form="cartCtrl.forms.SalesItems">
          <tr ng-if="!cartCtrl.cartItems.length">
            <td colspan="7">
              <label id="cartEmptyLabel"
                class="form-control-static font-weight-normal"
                data-translate="ui.storefront.cart.noItemsHaveBeenAddedToTheCart"></label>
            </td>
          </tr>
          <tr ng-repeat-start="(itemIndex, item) in (cartCtrl.cartItems.length > 20
                               ? (cartCtrl.cartItemsPaging.filteredData
                                | limitTo: cartCtrl.cartItemsPaging.pageSize
                                     : cartCtrl.cartItemsPaging.skip())
                               : cartCtrl.cartItems)
                   | orderBy: ['ProductName','ProductKey']">
            <td class="form-control-table-cell p-0 w-0"
              rowspan="{{cartCtrl.cefConfig.featureSet.inventory.preSale.enabled && item.ProductAllowPreSale
                     || cartCtrl.cefConfig.featureSet.inventory.backOrder.enabled && item.QuantityBackOrdered > 0
                     ? 2 : 1}}">
              <div cef-product-card-thumbnail-widget
                product="item.Product"
                product-id="item.ProductID"
                product-seo-url="item.ProductSeoUrl"
                product-name="item.ProductName"
                product-image="item.ProductPrimaryImage"
                width="100" height="100"
                index="itemIndex">
              </div>
            </td>
            <td>
              <a id="cartProductSku{{itemIndex}}"
                ui-sref-plus uisrp-is-product="true"
                uisrp-path="{{item.ProductSeoUrl}}">
                <label class="form-control-static font-weight-normal pointer"
                  ng-bind="item.ProductKey">
                </label>
              </a>
            </td>
            <td>
              <a id="cartProductName{{itemIndex}}"
                ui-sref-plus uisrp-is-product="true"
                uisrp-path="{{item.ProductSeoUrl}}">
                <label class="form-control-static font-weight-normal pointer"
                  ng-bind="item.ProductName">
                </label>
              </a>
              <ul>
                <li class="mt-1 small"
                  ng-repeat="kitComponent in item.Product.ProductAssociations | filter: { TypeKey: 'KIT-COMPONENT' }">
                  <strong><span ng-bind="kitComponent.Quantity"></span>x</strong><!--
                  -->&nbsp;<!--
                  --><a ui-sref-plus uisrp-is-product="true"
                      uisrp-path="{{kitComponent.SlaveSeoUrl}}">
                      <span ng-bind="kitComponent.SlaveName"></span>
                    </a>
                </li>
              </ul>
              <table ng-if="item.Discounts && item.Discounts.length"
                class="table table-borderless">
                <tr ng-repeat="(discountIndex, discount) in item.Discounts">
                  <td class="col text-right">
                    <span id="cartProductDiscountDescription{{itemIndex + '.' + discountIndex}}"
                      ng-bind="discount.Discount.Name">
                    </span>
                  </td>
                  <td class="col-auto text-danger">
                    <span id="cartProductDiscountValue{{itemIndex + '.' + discountIndex}}"
                      ng-bind="discount.DiscountValueType == 1
                          ? (discount.DiscountValue | globalizedCurrency)
                          : (discount.DiscountValue + '%')"></span>&nbsp;<!--
                    --><span data-translate="ui.storefront.common.Off"></span>
                  </td>
                  <td class="col-auto">
                    <button ng-if="!discount.Discount.IsAutoApplied"
                      type="button" class="btn btn-link text-danger top p-0"
                      id="btnRemoveDiscountFromItem{{itemIndex + '.' + discountIndex}}"
                      name="btnRemoveDiscountFromItem{{itemIndex + '.' + discountIndex}}"
                      translate-attr="{ title: 'ui.storefront.cart.removeDiscountFromItem',
                                        'aria-label': 'ui.storefront.cart.removeDiscountFromItem' }"
                      ng-click="cartCtrl.removeCartItemDiscount(discount.ID)">
                      <i class="far fa-lg fa-trash"></i>
                      <span class="sr-only"
                        data-translate="ui.storefront.cart.removeDiscountFromItem">
                      </span>
                    </button>
                  </td>
                </tr>
              </table>
            </td>
            <td ng-if="(!cartCtrl.cefConfig.loginForPricing.enabled || cartCtrl.cvAuthenticationService.isAuthenticated())"
              class="w-0 text-right">
              <div id="cartProductPrice{{itemIndex}}"
                class="form-control-static cart-price price text-right"
                ng-class="{'strike-through text-small text-disabled': item.UnitSoldPrice && item.UnitCorePrice != item.UnitSoldPrice && item.UnitSoldPrice > 0}"
                ng-bind="item.UnitCorePrice | globalizedCurrency">
              </div>
              <div class="form-control-static cart-price price text-right text-danger"
                ng-if="item.UnitSoldPrice && item.UnitCorePrice != item.UnitSoldPrice && item.UnitSoldPrice > 0"
                ng-bind="item.UnitSoldPrice | globalizedCurrency">
              </div>
            </td>
            <td ng-if="cartCtrl.cefConfig.loginForPricing.enabled && !cartCtrl.cvAuthenticationService.isAuthenticated()">
              <div cef-login-for-pricing></div>
            </td>
            <td ng-cloak="item">
              <div cef-add-to-cart-quantity-selector
                ng-init="item.TotalQuantity = item.Quantity + (item.QuantityBackOrdered || 0) + (item.QuantityPreSold || 0)"
                item-id="item.ProductID"
                sales-item="item"
                default-value="1"
                current-value="item.TotalQuantity"
                is-required="true"
                step="1"
                on-step="cartCtrl.updateCartItemQuantity"
                index="itemIndex"
                debug="false">
              </div>
            </td>
            <td ng-if="(!cartCtrl.cefConfig.loginForPricing.enabled || cartCtrl.cvAuthenticationService.isAuthenticated())"
              class="text-right">
              <div id="cartProductSubtotal{{itemIndex}}"
                class="form-control-static font-weight-normal text-right"
                ng-bind="(item.ExtendedPrice + item.DiscountTotal) | globalizedCurrency">
              </div>
              <!-- ng-class="{'strike-through text-small text-disabled': item.DiscountTotal && item.DiscountTotal < 0 }"
              <div ng-if="item.DiscountTotal"
                id="cartProductSubtotalWithDiscounts{{itemIndex}}"
                class="form-control-static font-weight-normal text-right text-danger"
                ng-bind="(item.ExtendedPrice + item.DiscountTotal) | globalizedCurrency">
              </div>
              -->
            </td>
            <td ng-if="cartCtrl.cefConfig.loginForPricing.enabled && !cartCtrl.cvAuthenticationService.isAuthenticated()">
              <div cef-login-for-pricing></div>
            </td>
            <td>
              <button type="button" class="btn btn-link text-danger"
                id="btnRemoveItem{{itemIndex}}FromCart"
                name="btnRemoveItem{{itemIndex}}FromCart"
                translate-attr="{ title: 'ui.storefront.cart.removeItemFromCart',
                                  'aria-label': 'ui.storefront.cart.removeItemFromCart' }"
                ng-click="cartCtrl.removeCartItem(item.ID)">
                <i class="far fa-lg fa-trash"></i>
                <span class="sr-only" data-translate="ui.storefront.cart.removeItemFromCart"></span>
              </button>
            </td>
          </tr>
          <tr ng-repeat-end>
            <td colspan="6"
              ng-if="cartCtrl.cefConfig.featureSet.inventory.preSale.enabled && item.ProductAllowPreSale
                  || cartCtrl.cefConfig.featureSet.inventory.backOrder.enabled && item.QuantityBackOrdered > 0">
              <div class="alert alert-warning mb-0" ng-if="item.ProductAllowPreSale">
                <p class="mb-0">
                  This item in is pre-sales, orders with this item will be fulfilled once the item
                  becomes available for normal sales. Mixed orders may be separated after purchase
                  to fullfill based on availability.
                </p>
              </div>
              <div class="alert alert-warning mb-0" ng-if="item.QuantityBackOrdered > 0">
                <p class="mb-0">
                  This item is on back-order, orders with this item will be fulfilled once the item
                  becomes available in stock. Mixed orders may be separated after purchase to
                  fullfill based on availability.
                </p>
              </div>
            </td>
          </tr>
          <tr ng-repeat="(discountIndex, discount) in cartCtrl.orderDiscounts">
            <td></td>
            <td>
              <div id="orderDiscountType{{discountIndex}}"
                class="form-control-static font-weight-normal">
                <span data-translate="ui.storefront.cart.orderDiscountType"></span>
              </div>
            </td>
            <td>
              <div id="orderDiscountName{{discountIndex}}"
                class="form-control-static font-weight-normal"
                ng-bind="discount.Discount.Name">
              </div>
            </td>
            <td class="text-right">
              <div id="orderDiscountValue{{discountIndex}}"
                class="form-control-static cart-price price text-right text-danger"
                ng-bind="discount.DiscountValueType == 1
                      ? (discount.DiscountValue | globalizedCurrency)
                      : (discount.DiscountValue + '%')"></div>
            </td>
            <td></td>
            <td>
              <div id="orderDiscountTotal{{discountIndex}}"
                class="form-control-static cart-price price text-right text-danger"
                ng-bind="discount.Discount.DiscountTotal | globalizedCurrency">
              </div>
            </td>
            <td>
              <button ng-if="!discount.Discount.IsAutoApplied"
                type="button" class="btn btn-link text-danger top"
                id="btnRemoveOrderDiscount{{discountIndex}}"
                name="btnRemoveOrderDiscount{{discountIndex}}"
                translate-attr="{ title: 'ui.storefront.cart.removeItemFromCart',
                                  'aria-label': 'ui.storefront.cart.removeOrderDiscountFromCart' }"
                ng-click="cartCtrl.removeCartDiscount(discount.ID)">
                <i class="far fa-lg fa-trash"></i>
                <span class="sr-only"
                  data-translate="ui.storefront.cart.removeOrderDiscountFromCart">
                </span>
              </button>
            </td>
          </tr>
          <tr ng-repeat="(discountIndex, discount) in cartCtrl.shippingDiscounts">
            <td></td>
            <td>
              <div id="shipmentDiscountType{{discountIndex}}"
                class="form-control-static font-weight-normal">
                <span data-translate="ui.storefront.cart.shipmentDiscountType"></span>
              </div>
            </td>
            <td>
              <div id="shipmentDiscountName{{discountIndex}}"
                class="form-control-static font-weight-normal">
                <span ng-bind="discount.Discount.Name"></span>
              </div>
            </td>
            <td class="text-right">
              <div id="shipmentDiscountValue{{discountIndex}}"
                class="form-control-static cart-price price text-right text-danger"
                ng-bind="discount.DiscountValueType == 1
                      ? (discount.DiscountValue | globalizedCurrency)
                      : (discount.DiscountValue + '%')">
              </div>
            </td>
            <td></td>
            <td>
              <div id="shipmentDiscountTotal{{discountIndex}}"
                class="form-control-static font-weight-normal text-right text-danger"
                ng-bind="discount.Discount.DiscountTotal | globalizedCurrency">
              </div>
            </td>
            <td>
              <button ng-if="!discount.Discount.IsAutoApplied"
                type="button" class="btn btn-link text-danger top"
                id="btnRemoveShipmentDiscount{{discountIndex}}"
                name="btnRemoveShipmentDiscount{{discountIndex}}"
                translate-attr="{ title: 'ui.storefront.cart.removeItemFromCart',
                                  'aria-label': 'ui.storefront.cart.removeShipmentDiscountFromCart' }"
                ng-click="cartCtrl.removeCartDiscount(discount.ID)">
                <i class="far fa-lg fa-trash"></i>
                <span class="sr-only"
                  data-translate="ui.storefront.cart.removeShipmentDiscountFromCart">
                </span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<div class="cart-collaterals row">
  <div ng-if="cartCtrl.includeQuickOrder"
    cef-quick-add-to-cart type="cartCtrl.type" flyout-count="8"
    class="col-12 col-sm-auto col-md-auto col-lg-auto col-xl-auto mb-3">
  </div>
  <div class="col">
    <div ng-if="cartCtrl.fullIncludeShippingCheck"
      cef-cart-rate-quotes-manager-widget
      type="cartCtrl.type"
      class="shipping">
    </div>
  </div>
  <div class="col-12 col-sm-auto col-md-auto col-lg-auto col-xl-auto totals">
    <h3 data-translate="ui.storefront.cart.shoppingCartTotal"></h3>
    <table class="table shopping-cart-table-total table-striped table-hover"
      id="tableCartTotals">
      <colgroup>
        <col class="" />
      </colgroup>
      <tbody>
        <tr>
          <td class="a-right" data-translate="ui.storefront.common.Subtotal"></td>
          <td id="cartTotalsSubtotal"
            class="a-left price text-right"
            ng-bind="(cartCtrl.cvCartService.carts[cartCtrl.type].Totals.SubTotal || 0) | globalizedCurrency">
          </td>
        </tr>
        <tr ng-show="cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Shipping > 0">
          <td class="a-right" data-translate="ui.storefront.common.Shipping"></td>
          <td id="cartTotalsShipping"
            class="a-left price text-right"
            ng-class="{'strike-through' : cartCtrl.shippingStrikethrough }"
            ng-bind="(cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Shipping || 0) | globalizedCurrency">
          </td>
        </tr>
        <tr ng-show="cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Handling > 0">
          <td class="a-right" data-translate="ui.storefront.common.Handling"></td>
          <td id="cartTotalsHandling"
            class="a-left price text-right"
            ng-bind="(cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Handling || 0) | globalizedCurrency">
          </td>
        </tr>
        <tr ng-show="cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Fees > 0">
          <td class="a-right" data-translate="ui.storefront.common.Fee.Plural"></td>
          <td id="cartTotalsFees"
            class="a-left price text-right"
            ng-bind="(cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Fees || 0) | globalizedCurrency">
          </td>
        </tr>
        <tr ng-show="cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Discounts < 0">
          <td class="a-right" data-translate="ui.storefront.common.Discount.Plural"></td>
          <td id="cartTotalsDiscounts"
            class="a-left price text-right"
            ng-bind="(cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Discounts || 0) | globalizedCurrency">
          </td>
        </tr>
        <tr ng-show="cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Tax > 0">
          <td class="a-right" data-translate="ui.storefront.cart.Taxes"></td>
          <td id="cartTotalsTaxes"
            class="a-left price text-right"
            ng-bind="(cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Tax || 0) | globalizedCurrency">
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td class="a-right bold" data-translate="ui.storefront.cart.grandTotal"></td>
          <td id="cartTotalsTotal"
            class="a-left price text-right bold"
            ng-bind="(cartCtrl.cvCartService.carts[cartCtrl.type].Totals.Total || 0) | globalizedCurrency">
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <button type="button" class="btn btn-block btn-success btn-lg"
              id="btnProceedToCheckout" name="btnProceedToCheckout"
              ui-sref-plus uisrp-area="checkout"
              translate-attr="{ title: 'ui.storefront.cart.proceedToCheckout',
                                'aria-label': 'ui.storefront.cart.proceedToCheckout' }"
              ng-disabled="!cartCtrl.cvCartService.validForCheckout || !cartCtrl.cvCartService.carts[cartCtrl.type].ItemQuantity">
              <span data-translate="ui.storefront.cart.proceedToCheckout"></span>
            </button>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
