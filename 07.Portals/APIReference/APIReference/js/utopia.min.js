function $(n,t){return typeof n=="string"?(t||document).querySelector(n):n}function $$(n,t){var i=(t||document).querySelectorAll(n),u,r;try{return Array.prototype.slice.call(i)}catch(f){for(u=Array(i.length),r=i.length;r-->0;)u[r]=i[r];return u}}Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var i=0,r=this.length;i<r;++i)n.call(t||this,this[i],i,this)});$$("[id]").forEach(function(n){window[n.id]=n});String.prototype.splice=function(n,t,i){return t=+t||0,i=i||"",this.slice(0,n)+i+this.slice(n+t)},function(){var n=window.Utopia={type:function(n){if(n===null)return"null";if(n===undefined)return"undefined";var t=Object.prototype.toString.call(n).match(/^\[object\s+(.*?)\]$/)[1];return(t=t?t.toLowerCase():"",t=="number"&&isNaN(n))?"NaN":t},each:function(t,i,r){var f,u;if(!n.type(i)=="function")throw Error("The second argument in Utopia.each() must be a function");r=r||t;for(f in t)if(t.hasOwnProperty&&t.hasOwnProperty(f)&&(u=i.call(r,t[f],f),!!u||u===0||u===""))return u;return null},merge:function(){for(var t,i,r={},n=0;n<arguments.length;n++){t=arguments[n];for(i in t)r[i]=t[i]}return r},attach:function(n){for(var r,i,t=0;t<arguments.length;t++){r=arguments[t];for(i in r)i in n||(n[i]=r[i])}return n},element:{create:function(){var t,f,i,r,u;return n.type(arguments[0])==="string"?n.type(arguments[1])==="object"?(t=arguments[1],t.tag=arguments[0]):(t={tag:arguments[0]},n.type(arguments[1])==="array"?t.contents=arguments[1]:(n.type(arguments[1])==="string"||n.type(arguments[1])==="number")&&(t.contents=[""+arguments[1]])):t=arguments[0],f=t.namespace||"",i=f?document.createElementNS(f,t.tag):document.createElement(t.tag),(t.className||t.id)&&(t.properties=t.properties||{},t.properties.className=t.className,t.properties.id=t.id),n.element.set(i,t),t.before&&(r=$(t.before),r&&r.parentNode&&r.parentNode.insertBefore(i,r)),t.after&&i.parentNode===null&&(u=$(t.after),u&&u.parentNode&&u.parentNode.insertBefore(i,u.nextSibling)),t.inside&&i.parentNode===null&&$(t.inside).appendChild(i),i},set:function(t,i){return n.element.prop(t,i.properties||i.prop),n.element.attr(t,i.attributes||i.attr),n.element.contents(t,i.contents),t},prop:function(n,t){if(t)for(var i in t)n[i]=t[i];return n},attr:function(n,t){if(t)for(attr in t)n.setAttribute(attr,t[attr]);return n},contents:function(t,i,r){var o,e,u,f;if(i||i===0)for(n.type(i)!=="array"&&(i=[i]),o=t.firstChild,e=0;e<i.length;e++){u=i[e];switch(n.type(u)){case"string":if(u==="")continue;case"number":f=document.createTextNode(u);break;case"object":f=n.element.create(u);break;default:f=u}f&&(r&&r!=="end"?r==="start"&&t.insertBefore(f,o):t.appendChild(f))}return t}},elements:{},event:{bind:function(t,i,r,u){var o,f,e;if(n.type(t)==="string"||n.type(t)==="array")o=n.type(t)==="string"?$$(t):t,o.forEach(function(t){n.event.bind(t,i,r,u)});else if(n.type(i)==="string")u?t["on"+i]=r:t.addEventListener(i,r,!1);else if(n.type(i)==="array")for(f=0;f<i.length;f++)n.event.bind(t,i[f],r,arguments[2]);else for(e in i)n.event.bind(t,e,i[e],arguments[2])},fire:function(t,i,r){var f,u;n.type(t)==="string"||n.type(t)==="array"?(f=n.type(t)==="string"?$$(t):t,f.forEach(function(t){n.event.fire(t,i,r)})):document.createEvent&&(u=document.createEvent("HTMLEvents"),u.initEvent(i,!0,!0),u.custom=!0,r&&n.attach(u,r),t.dispatchEvent(u))}},xhr:function(n){var u;document.body.setAttribute("data-loading","");var t=new XMLHttpRequest,i=n.method||"GET",r=n.data||"";t.open(i,n.url+(i==="GET"&&r?"?"+r:""),!0);n.headers=n.headers||{};i==="GET"||n.headers["Content-type"]||n.headers["Content-Type"]||t.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(u in n.headers)t.setRequestHeader(u,n.headers[u]);return t.onreadystatechange=function(){t.readyState===4&&(document.body.removeAttribute("data-loading"),n.callback(t))},t.send(i==="GET"?null:r),t},script:function(t,i,r){return r=r||document,n.element.create({tag:"script",properties:{src:t,"async":!0,onload:i},inside:r.documentElement})},offset:function(n){var i=0,r=0,t=n;if(t.parentNode){do i+=t.offsetLeft,r+=t.offsetTop;while((t=t.offsetParent)&&t.nodeType<9);t=n;do i-=t.scrollLeft,r-=t.scrollTop;while((t=t.parentNode)&&!/body/i.test(t.nodeName))}return{top:r,right:innerWidth-i-n.offsetWidth,bottom:innerHeight-r-n.offsetHeight,left:i}}};["set","prop","attr","contents"].forEach(function(t){n.elements[t]=function(i){i=n.type(i)==="string"?$$(i):Array.prototype.slice.call(i);var r=Array.prototype.slice.call(arguments);return r.shift(),i.map(function(i){return n.element[t](i,r)})}})}();window.$u=window.$u||Utopia;